{# Generic form layout used by all create/update pages #}
<h2 class="mb-1">{{ title }}</h2>
{% if subtitle %}<p class="muted mt-0">{{ subtitle }}</p>{% endif %}

<form method="post" novalidate>
  {% csrf_token %}

  {% if form.non_field_errors %}
    <div class="alert alert--error">
      {% for e in form.non_field_errors %}<div>{{ e }}</div>{% endfor %}
    </div>
  {% endif %}

  {# 1) Hidden inputs first (e.g., locked Building). Keep their errors visible. #}
  {% for h in form.hidden_fields %}
    {{ h }}
    {% if h.errors %}
      <div class="errors">{% for e in h.errors %}<div>{{ e }}</div>{% endfor %}</div>
    {% endif %}
  {% endfor %}

  {# 2) Render only visible fields (no labels for hidden ones). #}
  {% for field in form.visible_fields %}
    <div class="form-row{% if field.errors %} has-errors{% endif %}">
      {% if field.field.widget.input_type == 'checkbox' %}
        <label class="checkbox">
          {{ field }} <span>{{ field.label }}</span>
        </label>
        {% if field.help_text %}<div class="help">{{ field.help_text|safe }}</div>{% endif %}
        {% if field.errors %}
          <div class="errors">{% for e in field.errors %}<div>{{ e }}</div>{% endfor %}</div>
        {% endif %}
      {% else %}
        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field }}
        {% if field.help_text %}<div class="help">{{ field.help_text|safe }}</div>{% endif %}
        {% if field.errors %}
          <div class="errors">{% for e in field.errors %}<div>{{ e }}</div>{% endfor %}</div>
        {% endif %}
      {% endif %}
    </div>
  {% endfor %}

  <div class="row gap mt-2">
    <button class="btn" type="submit">Save</button>
    <a class="btn" href="{{ cancel_url|default:'javascript:history.back()' }}">Cancel</a>
  </div>
</form>
