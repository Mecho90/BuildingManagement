{% extends "base.html" %}
{% load i18n static %}

{# ------------------ <title> ------------------ #}
{% block title %}
  {# Prefer the building injected by the view; otherwise, only use instance.building
     when a building_id exists to avoid RelatedObjectDoesNotExist. #}
  {% if building %}
    {% if form.instance.pk %}
      {% blocktrans with name=building.name %}Edit Unit 路 {{ name }}{% endblocktrans %}
    {% else %}
      {% blocktrans with name=building.name %}New Unit 路 {{ name }}{% endblocktrans %}
    {% endif %}
  {% elif form.instance.building_id %}
    {% if form.instance.pk %}
      {% blocktrans with name=form.instance.building.name %}Edit Unit 路 {{ name }}{% endblocktrans %}
    {% else %}
      {% blocktrans with name=form.instance.building.name %}New Unit 路 {{ name }}{% endblocktrans %}
    {% endif %}
  {% else %}
    {% if form.instance.pk %}{% trans "Edit Unit" %}{% else %}{% trans "New Unit" %}{% endif %}
  {% endif %}
{% endblock %}

{# ------------------ Page content ------------------ #}
{% block content %}
  {% if building %}
    {% if form.instance.pk %}
      {% blocktrans with name=building.name asvar page_title %}Edit Unit in {{ name }}{% endblocktrans %}
      {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
    {% else %}
      {% blocktrans with name=building.name asvar page_title %}New Unit in {{ name }}{% endblocktrans %}
      {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
    {% endif %}

  {% elif form.instance.building_id %}
    {% if form.instance.pk %}
      {% blocktrans with name=form.instance.building.name asvar page_title %}Edit Unit in {{ name }}{% endblocktrans %}
      {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
    {% else %}
      {% blocktrans with name=form.instance.building.name asvar page_title %}New Unit in {{ name }}{% endblocktrans %}
      {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
    {% endif %}

  {% else %}
    {# Robust fallback if no building is available yet #}
    {% if form.instance.pk %}
      {% include "core/_form_layout.html" with form=form title=_('Edit Unit') cancel_url=cancel_url %}
    {% else %}
      {% include "core/_form_layout.html" with form=form title=_('New Unit') cancel_url=cancel_url %}
    {% endif %}
  {% endif %}
{% endblock %}
