{% extends "base.html" %}
{% load static %}

{# ------------------ <title> ------------------ #}
{% block title %}
  {# Prefer the building injected by the view; otherwise, only use instance.building
     when a building_id exists to avoid RelatedObjectDoesNotExist. #}
  {% if building %}
    {% if form.instance.pk %}
      Edit Unit 路 {{ building.name }}
    {% else %}
      New Unit 路 {{ building.name }}
    {% endif %}
  {% elif form.instance.building_id %}
    {% if form.instance.pk %}
      Edit Unit 路 {{ form.instance.building.name }}
    {% else %}
      New Unit 路 {{ form.instance.building.name }}
    {% endif %}
  {% else %}
    {% if form.instance.pk %}Edit Unit{% else %}New Unit{% endif %}
  {% endif %}
{% endblock %}

{# ------------------ Page content ------------------ #}
{% block content %}
  {% if building %}
    {% if form.instance.pk %}
      {% with page_title="Edit Unit in "|add:building.name %}
        {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
      {% endwith %}
    {% else %}
      {% with page_title="New Unit in "|add:building.name %}
        {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
      {% endwith %}
    {% endif %}

  {% elif form.instance.building_id %}
    {% if form.instance.pk %}
      {% with page_title="Edit Unit in "|add:form.instance.building.name %}
        {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
      {% endwith %}
    {% else %}
      {% with page_title="New Unit in "|add:form.instance.building.name %}
        {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
      {% endwith %}
    {% endif %}

  {% else %}
    {# Robust fallback if no building is available yet #}
    {% with page_title=form.instance.pk|yesno:"Edit Unit,New Unit" %}
      {% include "core/_form_layout.html" with form=form title=page_title cancel_url=cancel_url %}
    {% endwith %}
  {% endif %}
{% endblock %}
