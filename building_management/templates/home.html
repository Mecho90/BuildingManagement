<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <title>–ù–∞—á–∞–ª–Ω–∞ –°—Ç—Ä–∞–Ω–∏—Ü–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 2rem; }
    .wrap { max-width: 760px; margin: 6vh auto; display: grid; gap: 1.25rem; }
    .chip { display: inline-block; padding: 0.4rem 0.7rem; border: 1px solid #ddd; border-radius: 999px; }
    .row { display: flex; gap: .5rem; align-items: center; }
    .card { border: 1px solid #e5e5e5; border-radius: 12px; padding: 1rem; }
    input, button, select { padding: 0.6rem 0.7rem; border-radius: 8px; border: 1px solid #bbb; }
    button { cursor: pointer; background: #fff; }
    ul { list-style: none; padding: 0; margin: 0; }
    li { display: flex; align-items: center; justify-content: space-between; padding: .5rem 0; border-bottom: 1px dashed #eee; }
    .done { text-decoration: line-through; opacity: .6; }
    .actions { display: flex; gap: .5rem; align-items: center; }
    a { color: inherit; }
    small { color: #666; }
    .task-left { display: inline-flex; align-items: center; gap: .5rem; }

    .check { color: #16a34a; font-weight: 700; }  /* –û–±—Ä–∞–±–æ—Ç–µ–Ω–æ */
    .warn  { color: #ca8a04; font-weight: 700; }  /* –í –ø—Ä–æ—Ü–µ–ª –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ -> ‚ö†Ô∏è */
    .alert { color: #dc2626; font-weight: 700; }  /* –í –ø—Ä–æ—Ü–µ—Å –Ω–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ -> üö® */
  </style>
</head>
<body>
  <div class="wrap">
    <header class="row" style="justify-content: space-between;">
      <div>
        <h1>–î–æ–±—Ä–µ –î–æ—à—ä–ª</h1>
        <p class="chip">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª: {{ username }}</p>
      </div>
      <div><a href="/logout">–û—Ç–ø–∏—Å–≤–∞–Ω–µ</a></div>
    </header>

    <section class="card">
      <h2 style="margin:0 0 .75rem">–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –∑–∞–¥–∞—á–∞</h2>
      <form method="post" action="/tasks" class="row" autocomplete="off">
        <input name="title" type="text" placeholder="–ø—Ä–∏–º–µ—Ä: –í–∑–µ–º–∞—Ç–µ –Ω–∞ –¥–æ–≥–æ–≤–æ—Ä –æ—Ç –æ–±—â–∏–Ω–∞ –°–ª–∞—Ç–∏–Ω–∞" required style="flex:1" />
        <button type="submit">–î–æ–±–∞–≤—è–Ω–µ</button>
      </form>
    </section>

    <section class="card">
      <h2 style="margin:0 0 .75rem">–ú–æ–∏ –ó–∞–¥–∞—á–∏</h2>
      {% if tasks and tasks|length > 0 %}
        <ul>
          {% for t in tasks %}
          <li>
            <span class="task-left">
              {% if t.status == "–û–±—Ä–∞–±–æ—Ç–µ–Ω–æ" %}
                <span class="check" aria-hidden="true">‚úì</span>
              {% elif t.status == "–í –ø—Ä–æ—Ü–µ–ª –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞" %}
                <span class="warn" aria-hidden="true">‚ö†Ô∏è</span>
              {% elif t.status == "–í –ø—Ä–æ—Ü–µ—Å –Ω–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ" %}
                <span class="alert" aria-hidden="true">üö®</span>
              {% endif %}
              <span class="{% if t.status == '–û–±—Ä–∞–±–æ—Ç–µ–Ω–æ' %}done{% endif %}">{{ t.title }}</span>
            </span>

            <span class="actions">
              <!-- Dropdown with BG labels -->
              <form method="post" action="/tasks/{{ t.id }}/status">
                <select name="status" onchange="this.form.submit()">
                  {% for s in STATUSES %}
                    <option value="{{ s }}" {% if t.status == s %}selected{% endif %}>{{ s }}</option>
                  {% endfor %}
                </select>
              </form>

              <!-- Archive visible only when –û–±—Ä–∞–±–æ—Ç–µ–Ω–æ -->
              {% if t.status == "–û–±—Ä–∞–±–æ—Ç–µ–Ω–æ" %}
              <form method="post" action="/tasks/{{ t.id }}/archive" onsubmit="return confirm('–ê—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–¥–∞—á–∞?');">
                <button type="submit">–ê—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ</button>
              </form>
              {% endif %}

              <form method="post" action="/tasks/{{ t.id }}/delete" onsubmit="return confirm('–î–∞ –∏–∑—Ç—Ä–∏—è –∑–∞–¥–∞—á–∞—Ç–∞ –∑–∞–≤–∏–Ω–∞–≥–∏?');">
                <button type="submit">–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ</button>
              </form>
            </span>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p><em>–ù—è–º–∞ –ó–∞–¥–∞—á–∏</em></p>
      {% endif %}
    </section>

    <section class="card">
      <h2 style="margin:0 0 .75rem">–ê—Ä—Ö–∏–≤</h2>
      {% if archived and archived|length > 0 %}
        <ul>
          {% for t in archived %}
          <li>
            <span class="task-left">
              <span class="check" aria-hidden="true">‚úì</span>
              <span class="done">{{ t.title }}</span>
            </span>
            <span class="actions">
              <form method="post" action="/tasks/{{ t.id }}/unarchive">
                <button type="submit">–í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ</button>
              </form>
              <form method="post" action="/tasks/{{ t.id }}/delete" onsubmit="return confirm('–î–∞ –∏–∑—Ç—Ä–∏—è –∑–∞–¥–∞—á–∞—Ç–∞ –∑–∞–≤–∏–Ω–∞–≥–∏?');">
                <button type="submit">–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ</button>
              </form>
            </span>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p><em>–ù—è–º–∞ –∞—Ä—Ö–∏–≤–∏—Ä–∞–Ω–∏ –∑–∞–¥–∞—á–∏</em></p>
      {% endif %}
    </section>
  </div>
</body>
</html>